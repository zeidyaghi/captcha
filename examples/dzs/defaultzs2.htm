<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" dir="rtl">

<head>

<meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
<title>Add Comments أضف ملاحظاتك في دفتر الزوّار</title>

<style>
 #mainCaptcha {
    background-image:url('captcha-bg.png');
    width:94px;
    font-size:large;
    font-style:italic;
    font-weight:bold;
    color:navy;
}
</style>

<script type="text/javascript">
    function generateCaptcha() {
        var alpha = new Array('A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z','a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v','w','x','y','z');
        var i;
        var a = alpha[Math.floor(Math.random() * alpha.length)];
        var b = alpha[Math.floor(Math.random() * alpha.length)];
        var c = alpha[Math.floor(Math.random() * alpha.length)];
        var d = alpha[Math.floor(Math.random() * alpha.length)];
        var code = a + ' ' + b + ' ' + ' ' + c + ' ' + d;
        document.getElementById("mainCaptcha").value = code;
    }

    function CheckValidCaptcha() {
        var string1 = removeSpaces(document.getElementById('mainCaptcha').value);
        var string2 = removeSpaces(document.getElementById('txtInput').value);
        if (string2 === "") {
            document.getElementById('error').innerHTML = "يرجى إدخال رمز التحقق.";
            document.getElementById('success').innerHTML = "";
            return false;
        }
        if (string1 === string2) {
            document.getElementById('success').innerHTML = "OK :تم التحقق بنجاح";
            document.getElementById('error').innerHTML = "";
            return true;
        } else {
            document.getElementById('error').innerHTML = "من فضلك،ادخل رمزاً مطابقاً"; 
            document.getElementById('success').innerHTML = "";
            return false;
        }
    }

    function removeSpaces(string) {
        return string.split(' ').join('');
    }
</script>    
</head>

<body style="width: 480px; margin-right: 400px;" onload="generateCaptcha();">
<center>

<p><b><font face="Arial" color="#008000" size="3">مرحباً بكم في دفتر الزوّار، ملاحظاتكم تسعدنا.</font>
<font face="Arial" color="#000080" size="3">ادخل المعلومات ورمز التحقق، من فضلك.</font></b></p>
<img src="gb2.gif" alt="أهلاً بكم"/>

<form id="commentForm" action="../messagesent.htm" method="post" dir="rtl" style="width: 468px">
    <p>المعلومات</p>
    <input name="name" type="text" style="border:1px red solid" autofocus placeholder="الاسم الكامل" required />
    <br/><br/>
    <input name="email" type="text" autofocus placeholder="البريد الالكتروني" />
    <br/><br/>
    <input name="website" type="text" autofocus placeholder="الموقع الالكتروني" />
    <br/><br/>
    <textarea name="comment" cols="20" rows="2" style="border:1px red solid" autofocus placeholder="ملاحظات" required></textarea>
    <br/><br/>
    
    <p>رمز التحقق</p>    
    <table>
        <tr>
            <td><span id="success" style="color:green"></span></td>
        </tr>
        <tr>
            <td>
                <input type="text" id="mainCaptcha" readonly="readonly" />&nbsp;&nbsp;&nbsp;&nbsp; 
                <img src="refresh.gif" onclick="generateCaptcha();" alt="Refresh" longdesc="تحديث الرمز"> </img>
            </td>
        </tr>
        <tr>
            <td>
                <input type="text" id="txtInput" maxlength="4" style="width: 85px" autofocus placeholder="ادخل الرمز هنا" required/>
                <input id="Button1" type="button" value="تحقق من الرمز" onclick="CheckValidCaptcha();"/>
            </td>
        </tr>
        <tr>
            <td><span id="error" style="color:red"></span></td>
        </tr>
    </table>
    <input id="submitBtn" name="Submit1" type="button" value="ارسال" title="ارسال المعلومات" />
</form>
<img src="gb22.png" alt="أهلاً بكم"/>

</center>

<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js'></script>
<script>
$(document).ready(function() {
    $("#submitBtn").click(function(event) {  
        event.preventDefault(); // منع الإرسال التلقائي للنموذج

        const name = $('input[name="name"]').val().trim();
        const comment = $('textarea[name="comment"]').val().trim();
        const captcha = $('#txtInput').val().trim();

        if (name === "" || comment === "") {
            alert("يرجى إدخال الاسم والملاحظات قبل المتابعة.");
            return;
        }

        if (!CheckValidCaptcha()) {
            alert("رمز التحقق غير صحيح. يرجى المحاولة مرة أخرى.");
            return;
        }
        // إذا كانت الحقول والكابتشا صحيحة، يمكن إرسال النموذج

        $("#commentForm").submit();// إرسال النموذج بعد التحقق

    });
});
</script>
</body>
</html>
